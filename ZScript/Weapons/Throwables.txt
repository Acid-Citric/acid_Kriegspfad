Class Dynamite_Thrown : Actor
{
	Default
	{
		Radius 12;
		Height 12;

		PROJECTILE;
		Height 10;
		Radius 10;
		Speed 5;
		BounceType "Doom";
		BounceFactor 0.5;
		WallBounceFactor 0.2;
		-NOGRAVITY
		-NOBLOCKMAP
		+BOUNCEONACTORS
		+FORCEXYBILLBOARD
	}
	States
	{
	Spawn:
		TNT_ A 1;
		Loop;
	Death:
		TNT_ A 1 BRIGHT
		{
			if (self is "Dynamite_Thrown_5") A_SpawnItemEx("Dynamite_Proj_5");
			else if (self is "Dynamite_Thrown_10") A_SpawnItemEx("Dynamite_Proj_10");
			else if (self is "Dynamite_Thrown_15") A_SpawnItemEx("Dynamite_Proj_15");
			else if (self is "Dynamite_Thrown_20") A_SpawnItemEx("Dynamite_Proj_20");
			else if (self is "Dynamite_Thrown_25") A_SpawnItemEx("Dynamite_Proj_25");
			else if (self is "Dynamite_Thrown_30") A_SpawnItemEx("Dynamite_Proj_30");
			else if (self is "Dynamite_Thrown_35") A_SpawnItemEx("Dynamite_Proj_35");
			else if (self is "Dynamite_Thrown_40") A_SpawnItemEx("Dynamite_Proj_40");
			else if (self is "Dynamite_Thrown_45") A_SpawnItemEx("Dynamite_Proj_45");
			return ResolveState(null);
		}
		Stop;
	}
}

Class Dynamite_Thrown_5 : Dynamite_Thrown {}
Class Dynamite_Thrown_10 : Dynamite_Thrown {}
Class Dynamite_Thrown_15 : Dynamite_Thrown {}
Class Dynamite_Thrown_20 : Dynamite_Thrown {}
Class Dynamite_Thrown_25 : Dynamite_Thrown {}
Class Dynamite_Thrown_30 : Dynamite_Thrown {}
Class Dynamite_Thrown_35 : Dynamite_Thrown {}
Class Dynamite_Thrown_40 : Dynamite_Thrown {}
Class Dynamite_Thrown_45 : Dynamite_Thrown {}

Class Dynamite_Proj : Actor
{
	Int timer, ticking;
	Default
	{
		Health 10;
		Damage (1);
		+SHOOTABLE
		+SOLID
		+NOBLOOD
		+DONTGIB
		+NOICEDEATH
		+NOTAUTOAIMED
		+DONTTHRUST
		+FORCEXYBILLBOARD
		DamageFactor "Normal", 2.0;
		DamageFactor "Fire", 2.0;
	}
	Override Void Tick()
	{
		If(ticking >= 35)
		{
			A_StartSound("dynamite/bomb_ticker",CHAN_BODY,CHANF_DEFAULT,1);
			ticking = 0;
		} 		
		ticking++;

		Super.Tick();
		If(timer == 0) { SetStateLabel("Explode"); }
		timer--;
	}
	States
	{
	Spawn:
		TNT_ A 1;
		Loop;
	Explode:
	Death:
		TNT1 A 0
		{
			A_StartSound("granate/explode");
			A_Explode(256, 256, XF_HURTSOURCE, True, 256);
			A_SpawnItemEx("BigBoom");
		}
		Stop;
	}
}

Class Dynamite_Proj_5 : Dynamite_Proj {	Override Void PostBeginPlay() { timer = 175; Super.PostBeginPlay();	} }
Class Dynamite_Proj_10 : Dynamite_Proj { Override Void PostBeginPlay() { timer = 350; Super.PostBeginPlay(); } }
Class Dynamite_Proj_15 : Dynamite_Proj { Override Void PostBeginPlay() { timer = 525; Super.PostBeginPlay(); } }
Class Dynamite_Proj_20 : Dynamite_Proj { Override Void PostBeginPlay() { timer = 700; Super.PostBeginPlay(); } }
Class Dynamite_Proj_25 : Dynamite_Proj { Override Void PostBeginPlay() { timer = 875; Super.PostBeginPlay(); } }
Class Dynamite_Proj_30 : Dynamite_Proj { Override Void PostBeginPlay() { timer = 1050; Super.PostBeginPlay(); } }
Class Dynamite_Proj_35 : Dynamite_Proj { Override Void PostBeginPlay() { timer = 1225; Super.PostBeginPlay(); } }
Class Dynamite_Proj_40 : Dynamite_Proj { Override Void PostBeginPlay() { timer = 1400; Super.PostBeginPlay(); } }
Class Dynamite_Proj_45 : Dynamite_Proj { Override Void PostBeginPlay() { timer = 1575; Super.PostBeginPlay(); } }

Class Granate_Thrown_A : Actor
{
	Int timer;
	Default
	{
		+ROLLSPRITE
		+ROLLCENTER
		+FORCEXYBILLBOARD

		Radius 4;
		Height 3;
		Speed 40;
		Damage (1);
		PROJECTILE;
		-NOGRAVITY
		-NOTELEPORT
		+CANBOUNCEWATER
		Obituary "%o failed to field %k's fragmenting fastball.";
		BounceType "Doom";
		BounceFactor 0.2;
		WallBounceFactor 0.6;
		BounceSound "grenade/bounce";
		SeeSound "granate/throw";
	}
	Override Void Tick()
	{
		Super.Tick();
		If(timer == 70) { SetStateLabel("Explode"); }
		timer++;
	}
	Override Void PostBeginPlay() { bSPRITEFLIP = random(0,1); Super.PostBeginPlay(); }
	States
	{
	Spawn:
		SHG_ X 1 A_SetRoll(Roll + 45.0, SPF_INTERPOLATE);
		Loop;
	Death:
		SHG_ X 0 A_SetRoll(Roll = 0);
	DeathLoop:
		SHG_ X 1 A_SetRoll(Roll = 90);
		Loop;
	Explode:
		TNT1 A 0
		{
			A_StartSound("granate/explode");
			A_Explode(128, 128, XF_HURTSOURCE, True, 128);
			A_SpawnItemEx("BigBoom_1");
		}
		Stop;
	}
}

Class Granate_Thrown_B : Granate_Thrown_A
{
	States
	{
	Spawn:
		SHG_ Y 1 A_SetRoll(Roll + 45.0, SPF_INTERPOLATE);
		Loop;
	Death:
		SHG_ Y 0 A_SetRoll(Roll = 0);
	DeathLoop:
		SHG_ Y 1 A_SetRoll(Roll = 90);
		Loop;
	Explode:
		TNT1 A 0
		{
			A_StartSound("granate/explode");
			A_Explode(256, 256, XF_HURTSOURCE, True, 256);
			A_SpawnItemEx("BigBoom_2");
		}
		Stop;
	}
}
